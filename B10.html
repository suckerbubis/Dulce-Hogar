<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Contacto ‚Äî Dulce Hogar</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html">üçû Dulce Hogar</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="shop.html">Tienda</a></li>
          <li class="nav-item"><a class="nav-link" href="order-tracking.html">Seguir Pedido</a></li>
          <li class="nav-item"><a class="nav-link" href="b09.html">√öltima Boleta</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container my-5">
    <div class="row justify-content-center">
      <div class="col-md-8">
        <h1 class="mb-3">Contacto y Sugerencias</h1>
        <p class="text-muted">¬øAlgo que mejorar? Cu√©ntanos y lo revisaremos.</p>

        <div class="card mb-4">
          <div class="card-body">
            <form id="contactForm">
              <div class="mb-3">
                <label class="form-label">Nombre</label>
                <input id="name" class="form-control" placeholder="Tu nombre" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Correo</label>
                <input id="email" type="email" class="form-control" placeholder="tu@email.com">
              </div>
              <div class="mb-3">
                <label class="form-label">Asunto</label>
                <input id="subject" class="form-control" placeholder="Breve resumen" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Mensaje</label>
                <textarea id="message" class="form-control" rows="5" placeholder="Escribe tu mensaje aqu√≠..." required></textarea>
              </div>
              <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary">Enviar</button>
                <button type="button" id="btnViewFeedback" class="btn btn-outline-secondary">Ver mensajes</button>
              </div>
            </form>
          </div>
        </div>

        <div id="feedbackList" class="card d-none">
          <div class="card-body">
            <h5 class="card-title">Mensajes enviados</h5>
            <div id="feedbackItems" class="list-group small"></div>
            <div class="mt-3 text-end"><button id="btnClearFeedback" class="btn btn-sm btn-danger">Borrar todo</button></div>
          </div>
        </div>

      </div>
    </div>
  </main>

  <script>
    function loadFeedback(){ try{ const raw = localStorage.getItem('dh_feedbacks'); return raw ? JSON.parse(raw) : []; }catch(e){ return []; } }
    function saveFeedback(list){ try{ localStorage.setItem('dh_feedbacks', JSON.stringify(list)); }catch(e){}
    }

    function renderFeedback(){ const list = loadFeedback(); const container = document.getElementById('feedbackItems'); container.innerHTML = ''; if(list.length===0){ document.getElementById('feedbackList').classList.add('d-none'); return;} list.slice().reverse().forEach(f=>{ const el = document.createElement('div'); el.className='list-group-item'; el.innerHTML = `<div class="fw-bold">${f.name} <small class="text-muted">${f.email||''}</small></div><div class="small text-secondary">${f.subject}</div><div class="mt-1">${f.message}</div><div class="small text-muted mt-2">${new Date(f.createdAt).toLocaleString()}</div>`; container.appendChild(el); }); document.getElementById('feedbackList').classList.remove('d-none'); }

    document.getElementById('contactForm').addEventListener('submit', function(e){ e.preventDefault(); const name = document.getElementById('name').value.trim(); const email = document.getElementById('email').value.trim(); const subject = document.getElementById('subject').value.trim(); const message = document.getElementById('message').value.trim(); if(!name || !subject || !message){ alert('Completa los campos obligatorios'); return; } const list = loadFeedback(); const item = { id: 'fb-' + Date.now(), name, email, subject, message, createdAt: new Date().toISOString() }; list.push(item); saveFeedback(list); renderFeedback(); this.reset(); alert('Gracias, tu mensaje fue guardado (simulado).'); });

    document.getElementById('btnViewFeedback').addEventListener('click', function(){ renderFeedback(); });
    document.getElementById('btnClearFeedback').addEventListener('click', function(){ if(!confirm('Borrar todos los mensajes?')) return; saveFeedback([]); renderFeedback(); });
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="es" data-bs-theme="dark">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dulce Hogar ‚Äî Panel de Despacho (Bootstrap 5.3.3)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Source+Code+Pro&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            background-color: var(--bs-body-bg);
            padding-top: 2rem;
        }
        .dispatch-panel {
            background-color: var(--bs-secondary-bg-subtle);
            border: 1px solid var(--bs-border-color);
            border-radius: 0.5rem;
            padding: 1.5rem;
            height: 100%;
        }
        .status-indicator {
            padding: 0.25rem 0.75rem;
            border-radius: 0.3rem;
            font-weight: 600;
        }
        .flow-step {
            flex: 1;
            position: relative;
            z-index: 2;
        }
        .flow-step.active .step-icon {
            background-color: var(--bs-primary);
            border-color: var(--bs-primary);
        }
        .flow-step.completed .step-icon {
            background-color: var(--bs-success);
            border-color: var(--bs-success);
        }
        .api-section {
            background-color: var(--bs-body-bg);
            border: 1px solid var(--bs-border-color);
            border-radius: 0.3rem;
            font-family: 'Source Code Pro', monospace;
        }
    </style>
</head>
<body>

<main class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="text-light fw-bolder">Orden de Despacho #12345</h1>
            <p class="text-secondary">Gesti√≥n de preparaci√≥n y env√≠o de pedidos.</p>
        </div>
    </div>
    
    <div class="row process-flow mb-5 justify-content-between position-relative">
        <div class="col-12 position-absolute top-0 start-0 h-100">
            <div class="bg-secondary position-absolute w-75 h-50" style="left: 12%; top: 20px; z-index: 1;"></div>
            <div id="progress-line" class="bg-primary position-absolute h-50" style="left: 12%; top: 20px; width: 0%; z-index: 1; transition: width 0.5s ease;"></div>
        </div>
        
        <div class="flow-step completed col">
            <div class="step-icon bg-secondary mx-auto mb-2 rounded-circle border border-2 d-flex align-items-center justify-content-center text-light" style="width:50px; height:50px;">
                <i class="bi bi-wallet-fill"></i>
            </div>
            <h5 class="small fw-bold mb-0">Pago</h5>
            <p class="small text-success mb-0">Confirmado</p>
        </div>
        
        <div class="flow-step completed col">
            <div class="step-icon bg-secondary mx-auto mb-2 rounded-circle border border-2 d-flex align-items-center justify-content-center text-light" style="width:50px; height:50px;">
                <i class="bi bi-file-text-fill"></i>
            </div>
            <h5 class="small fw-bold mb-0">Confirmado</h5>
            <p class="small text-secondary mb-0">Procesado</p>
        </div>
        
        <div class="flow-step active col">
            <div class="step-icon bg-secondary mx-auto mb-2 rounded-circle border border-2 d-flex align-items-center justify-content-center text-light" style="width:50px; height:50px;">
                <i class="bi bi-box-seam"></i>
            </div>
            <h5 class="small fw-bold mb-0">Despacho</h5>
            <p class="small text-primary mb-0">Generando</p>
        </div>
        
        <div class="flow-step col">
            <div class="step-icon bg-secondary mx-auto mb-2 rounded-circle border border-2 d-flex align-items-center justify-content-center text-light" style="width:50px; height:50px;">
                <i class="bi bi-truck"></i>
            </div>
            <h5 class="small fw-bold mb-0">Enviado</h5>
            <p class="small text-secondary mb-0">Pendiente</p>
        </div>
        
        <div class="flow-step col">
            <div class="step-icon bg-secondary mx-auto mb-2 rounded-circle border border-2 d-flex align-items-center justify-content-center text-light" style="width:50px; height:50px;">
                <i class="bi bi-check-circle-fill"></i>
            </div>
            <h5 class="small fw-bold mb-0">Entregado</h5>
            <p class="small text-secondary mb-0">Pendiente</p>
        </div>
    </div>
    
    <div class="row g-4 dispatch-panels">
        <div class="col-lg-6 col-xl-4">
            <div class="dispatch-panel">
                <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom border-secondary">
                    <h2 class="fs-5 fw-bolder mb-0">Detalles del Pedido</h2>
                    <span class="status-indicator bg-info-subtle text-info">Procesando</span>
                </div>
                
                <div class="row small">
                    <div class="col-6 mb-2"><span class="text-muted d-block">N¬∞ Pedido</span><span class="fw-bold">#12345</span></div>
                    <div class="col-6 mb-2"><span class="text-muted d-block">Cliente</span><span class="fw-bold">Ana Garc√≠a</span></div>
                    <div class="col-6 mb-2"><span class="text-muted d-block">Total</span><span class="fw-bold text-primary">$18.000</span></div>
                    <div class="col-6 mb-2"><span class="text-muted d-block">Estado Pago</span><span class="fw-bold text-success">‚úÖ Aprobado</span></div>
                    <div class="col-12 mt-2 pt-2 border-top border-secondary-subtle">
                        <span class="text-muted d-block">Direcci√≥n de Env√≠o</span>
                        <span class="fw-bold">Calle Falsa 1233, Santiago</span>
                        <button class="btn btn-sm btn-link text-warning p-0 ms-2" onclick="editShipping()">Editar</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6 col-xl-8">
            <div class="dispatch-panel">
                <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom border-secondary">
                    <h2 class="fs-5 fw-bolder mb-0">Productos y Stock</h2>
                    <div class="d-flex gap-2">
                        <span class="status-indicator bg-warning-subtle text-warning" id="preparation-status">Preparando</span>
                        <button class="btn btn-sm btn-outline-danger fw-bold" onclick="cancelOrder()">Cancelar</button>
                    </div>
                </div>
                
                <table class="table table-dark table-striped small">
                    <thead>
                        <tr>
                            <th>Producto</th>
                            <th class="text-center">Cant.</th>
                            <th class="text-center">Stock</th>
                            <th>Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>**Pan integral** <small class="text-muted d-block">PAN-001</small></td>
                            <td class="text-center">2</td>
                            <td class="text-center text-success">Disponible</td>
                            <td>$2.400</td>
                        </tr>
                        <tr>
                            <td>**Facturas surtidas** <small class="text-muted d-block">FAC-006</small></td>
                            <td class="text-center">6</td>
                            <td class="text-center text-success">Disponible</td>
                            <td>$12.000</td>
                        </tr>
                        <tr>
                            <td>**Torta de frutillas** <small class="text-muted d-block">TOR-003</small></td>
                            <td class="text-center">1</td>
                            <td class="text-center text-warning">¬°√öltimas u.s!</td>
                            <td>$3.600</td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="mt-3">
                    <h3 class="small fw-bold">Notas de preparaci√≥n</h3>
                    <textarea id="preparation-notes" class="form-control mt-1" rows="3" 
                              placeholder="Agregar notas para la preparaci√≥n...">Torta sin nueces por alergia. Empacar pan separado.</textarea>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 col-xl-4">
            <div class="dispatch-panel">
                <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom border-secondary">
                    <h2 class="fs-5 fw-bolder mb-0">Asignaci√≥n Log√≠stica</h2>
                    <span class="status-indicator bg-info-subtle text-info" id="driver-status">Por asignar</span>
                </div>
                
                <div class="mb-3">
                    <label for="driver-select" class="form-label small fw-bold">Repartidor</label>
                    <select id="driver-select" class="form-select">
                        <option value="">-- Seleccionar repartidor --</option>
                        <option value="driver1">Carlos Mart√≠nez (Disponible - 2 entregas hoy)</option>
                        <option value="driver2">Ana L√≥pez (Disponible - 1 entrega hoy)</option>
                        <option value="driver3">Pedro G√≥mez (En ruta - Regresa en 15 min)</option>
                        <option value="driver4">Mar√≠a Rodr√≠guez (No disponible - Fin de turno)</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label for="vehicle-type" class="form-label small fw-bold">Veh√≠culo</label>
                    <select id="vehicle-type" class="form-select">
                        <option value="scooter">Scooter el√©ctrico</option>
                        <option value="bike">Bicicleta</option>
                        <option value="car">Auto</option>
                        <option value="motorcycle">Moto</option>
                    </select>
                </div>
                
                <hr class="my-4 border-secondary">
                
                <div class="d-grid gap-2">
                    <button class="btn btn-primary fw-bold" onclick="generateDispatchOrder()" id="btn-generate">
                        <i class="bi bi-box-seam me-1"></i> Generar Orden de Despacho
                    </button>
                    <button class="btn btn-success fw-bold" onclick="markAsReady()" id="btn-ready">
                        <i class="bi bi-check-circle me-1"></i> Marcar como listo
                    </button>
                    <button class="btn btn-success fw-bold" onclick="markAsDispatched()" id="btn-dispatched" disabled>
                        <i class="bi bi-truck me-1"></i> Marcar como enviado
                    </button>
                    <button class="btn btn-secondary fw-bold" onclick="printDispatchOrder()">
                        <i class="bi bi-printer-fill me-1"></i> Imprimir orden
                    </button>
                </div>
            </div>
        </div>
        
        <div class="col-12">
            <div class="dispatch-panel api-section">
                <h3 class="small fw-bold">üì° Integraci√≥n API/Webhook</h3>
                <p class="small text-muted mb-1"><strong>Endpoint de Actualizaci√≥n:</strong> POST /api/orders/12345/dispatch</p>
                <p class="small text-muted"><strong>Funci√≥n:</strong> Llamada para notificar al sistema de *tracking* y al repartidor.</p>
                <pre class="bg-dark p-3 rounded small mt-2 overflow-auto">
{
  "orderId": "12345",
  "status": "despachando",
  "driverId": "driver1",
  "vehicleType": "scooter",
  "estimatedDelivery": "2024-12-03T13:40:00Z",
  "products": [...]
}</pre>
                <button class="btn btn-sm btn-outline-info fw-bold" onclick="simulateWebhook()">
                    <i class="bi bi-cloud-arrow-up-fill me-1"></i> Simular env√≠o de Webhook
                </button>
            </div>
        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script>
    let currentStepIndex = 2; // √çndice 2: Despacho (0:Pago, 1:Confirmado, 2:Despacho, 3:Enviado, 4:Entregado)
    
    // --- L√≥gica de la UI y API (Simulada) ---

    function updateProgress() {
        const steps = document.querySelectorAll('.flow-step');
        const numCompleted = currentStepIndex;
        // 80% es la distancia total de las l√≠neas de conexi√≥n
        const progress = (numCompleted / (steps.length - 1)) * 80; 
        document.getElementById('progress-line').style.width = `${progress}%`;
        
        steps.forEach((step, index) => {
            step.classList.remove('completed', 'active');
            if (index < currentStepIndex) {
                step.classList.add('completed');
            } else if (index === currentStepIndex) {
                step.classList.add('active');
            }
        });

        // Actualizar estado de botones
        document.getElementById('btn-generate').disabled = currentStepIndex > 2;
        document.getElementById('btn-ready').disabled = currentStepIndex !== 2;
        document.getElementById('btn-dispatched').disabled = currentStepIndex < 3;
    }
    
    function generateDispatchOrder() {
        const driverSelect = document.getElementById('driver-select');
        if (!driverSelect.value) {
            alert('Por favor selecciona un repartidor antes de generar la orden.');
            return;
        }
        
        const driverName = driverSelect.options[driverSelect.selectedIndex].text;
        
        // Simulaci√≥n: Llamada a POST /api/orders/12345/dispatch
        alert(`‚úÖ Orden de despacho generada para ${driverName}. Esto simula la llamada a la API.`);
        
        // Actualizar UI para el siguiente paso
        document.getElementById('driver-status').textContent = 'Asignado';
        document.getElementById('driver-status').className = 'status-indicator bg-success-subtle text-success';
        document.getElementById('preparation-status').textContent = 'En cocina';

        // Avance de estado interno (simulado)
        currentStepIndex = 2;
        updateProgress();
        document.getElementById('btn-ready').disabled = false;
        document.getElementById('btn-generate').disabled = true;

        // Simular notificaciones
        simulateNotification('Repartidor', driverName);
    }
    
    function markAsReady() {
        if (currentStepIndex !== 2) return;

        alert('‚úÖ Pedido marcado como listo para entrega. El repartidor est√° siendo notificado.');
        
        document.getElementById('preparation-status').textContent = 'Listo';
        document.getElementById('preparation-status').className = 'status-indicator bg-success-subtle text-success';
        
        // El pedido pasa del estado "Despacho" (Generando) al estado "Enviado" (Pendiente de recogida)
        currentStepIndex = 3;
        updateProgress();
    }
    
    function markAsDispatched() {
        if (currentStepIndex !== 3) return;

        if (confirm('¬øMarcar pedido como enviado? Esto actualiza el estado del cliente y notifica al tracking.')) {
            // Simulaci√≥n: Llamada a POST /api/orders/{id}/status con status=dispatched
            alert('üöö Pedido marcado como enviado. El cliente ha sido notificado.');
            
            // Avance de estado
            currentStepIndex = 4;
            updateProgress();
            
            // Simular redirecci√≥n al dashboard o a la siguiente orden
            setTimeout(() => {
                alert('Redireccionando al dashboard...');
                // window.location.href = 'admin-dashboard.html';
            }, 1500);
        }
    }
    
    function editShipping() {
        const newAddress = prompt('Nueva direcci√≥n (simulado):', 'Calle Falsa 1233, Santiago');
        if (newAddress) {
            alert('Direcci√≥n actualizada. Se ha llamado a la API para guardar el cambio.');
            // Llamada API: PUT/PATCH /api/orders/12345/shipping
        }
    }
    
    function cancelOrder() {
        if (confirm('¬øCancelar este pedido? Esto inicia el reembolso.')) {
            alert('‚ùå Pedido cancelado. Se ha llamado a la API de cancelaci√≥n/reembolso.');
        }
    }
    
    function simulateNotification(target, detail) {
        console.log(`üì± Notificaci√≥n enviada. Target: ${target}, Detalle: ${detail}`);
    }
    
    function simulateWebhook() {
        alert('üì° Webhook simulado enviado a sistemas externos (Tracking, Reparto).');
    }
    
    function printDispatchOrder() {
        alert('üñ®Ô∏è Se simula la impresi√≥n de la orden de despacho para el √°rea de cocina y el repartidor.');
    }
    
    // Inicializar
    document.addEventListener('DOMContentLoaded', function() {
        updateProgress();
        document.getElementById('driver-select').value = 'driver1'; // Repartidor por defecto
        
        // Habilitar/Deshabilitar botones en la carga inicial (basado en currentStepIndex)
        // La funci√≥n updateProgress() maneja esto autom√°ticamente.
    });
</script>
</body>
</html>
