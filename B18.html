<!DOCTYPE html>
<html lang="es" data-bs-theme="dark">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dulce Hogar ‚Äî Pedido En Camino (Bootstrap 5.3.3)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            background-color: var(--bs-body-bg);
            padding-top: 2rem;
            padding-bottom: 2rem;
        }
        .status-card {
            background-color: var(--bs-secondary-bg-subtle);
            border: 1px solid var(--bs-border-color);
            border-radius: 0.5rem;
            padding: 1.5rem;
        }
        .status-badge {
            background-color: rgba(139, 92, 246, 0.1);
            border: 1px solid #8b5cf6;
            color: #8b5cf6;
        }
        .delivery-driver {
            background-color: var(--bs-dark);
            border: 1px solid var(--bs-border-color);
        }
        .map-preview {
            height: 200px;
            background: linear-gradient(135deg, #1a2436, #0b0f16);
            border: 2px solid var(--bs-border-color);
            position: relative;
            overflow: hidden;
        }
        .map-marker { position: absolute; top: 50%; left: 30%; transform: translate(-50%, -50%); font-size: 2rem; }
        .map-destination { position: absolute; top: 30%; right: 20%; transform: translate(50%, -50%); font-size: 2rem; }
        .map-line { position: absolute; top: 40%; left: 35%; right: 25%; height: 4px; background: #8b5cf6; transform: rotate(15deg); }
        .channel-card.active { border-color: var(--bs-success); background-color: rgba(var(--bs-success-rgb), 0.1); }
    </style>
</head>
<body>

<main class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="status-card text-center mb-4">
                <div class="text-primary mb-3"><i class="bi bi-truck display-3"></i></div>
                <h1 class="fs-2 fw-bolder">¬°Tu pedido est√° en camino!</h1>
                <div class="status-badge d-inline-block px-3 py-1 fw-bold rounded-pill my-2">En camino</div>
            </div>

            <div class="delivery-driver d-flex align-items-center justify-content-center gap-3 p-3 rounded mb-4">
                <div class="text-info"><i class="bi bi-person-circle fs-2"></i></div>
                <div class="driver-info text-start">
                    <h3 class="fs-5 fw-bold mb-0">Repartidor asignado: Carlos Mart√≠nez</h3>
                    <p class="small mb-1">üìû +56 9 1234 5678</p>
                    <p class="small text-muted mb-0">üöó Veh√≠culo: Scooter el√©ctrico azul</p>
                </div>
            </div>

            <div class="status-card text-center mb-4">
                <h2 class="fs-4 fw-bolder">Tiempo estimado de llegada</h2>
                <div class="estimated-time text-warning fw-bolder" id="estimated-time-display">20 <span class="time-unit text-secondary fs-5">minutos</span></div>
                <p class="small text-muted mb-0">Hora estimada de entrega: <strong id="eta-hour">15:50</strong></p>
            </div>

            <div class="status-card mb-4">
                <h2 class="fs-5 fw-bolder">Seguimiento en tiempo real</h2>
                <div class="map-preview rounded-3 mb-3">
                    <div class="map-marker text-danger"><i class="bi bi-geo-alt-fill"></i></div>
                    <div class="map-destination text-success"><i class="bi bi-house-fill"></i></div>
                    <div class="map-line rounded-pill"></div>
                </div>
                <p class="small text-muted mb-0" id="distance-info">El repartidor se encuentra a <strong>3.5 km</strong> de tu ubicaci√≥n</p>
            </div>

            <div class="status-card mb-4">
                <h3 class="fs-5 fw-bolder">Historial de Ruta</h3>
                <div class="text-start" id="real-time-updates">
                    <div class="alert alert-info py-2 small mb-2"><i class="bi bi-person-fill me-2"></i> **Carlos Mart√≠nez:** ¬°Hola! Ya tengo tu pedido y estoy en camino.</div>
                    <div class="alert alert-secondary py-2 small mb-2"><i class="bi bi-box-seam me-2"></i> **Sistema:** El repartidor ha confirmado los productos correctos.</div>
                    <div class="alert alert-secondary py-2 small mb-2"><i class="bi bi-arrow-right-circle me-2"></i> **Sistema:** Repartidor ha salido del local.</div>
                </div>
            </div>
            
            <div class="status-card mb-4">
                <h2 class="fs-5 fw-bolder">Canales de notificaci√≥n activos</h2>
                <p class="small text-muted">Te avisaremos cuando el repartidor est√© a 5 minutos:</p>
                
                <div class="d-flex gap-3 justify-content-center flex-wrap">
                    <div class="channel-card p-3 rounded active" onclick="toggleChannel('email')">
                        <div class="text-info"><i class="bi bi-envelope fs-3"></i></div>
                        <div class="small fw-bold">Email</div>
                    </div>
                    <div class="channel-card p-3 rounded active" onclick="toggleChannel('sms')">
                        <div class="text-success"><i class="bi bi-chat-text fs-3"></i></div>
                        <div class="small fw-bold">SMS</div>
                    </div>
                    <div class="channel-card p-3 rounded" onclick="toggleChannel('push')">
                        <div class="text-primary"><i class="bi bi-app-indicator fs-3"></i></div>
                        <div class="small fw-bold">App Push</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script>
    let timeLeft = 20; // minutos (Simulaci√≥n de ETA)
    
    // --- L√≥gica de la UI y API (Simulada) ---
    
    function updateDeliveryTime() {
        if (timeLeft > 0) {
            timeLeft--;
            const timeElement = document.getElementById('estimated-time-display');
            timeElement.innerHTML = `${timeLeft} <span class="time-unit text-secondary fs-5">minutos</span>`;
            
            // Actualizar la hora ETA
            const now = new Date();
            const eta = new Date(now.getTime() + timeLeft * 60000);
            document.getElementById('eta-hour').textContent = eta.toLocaleTimeString('es-CL', { hour: '2-digit', minute: '2-digit' });

            // L√≥gica de 5 minutos (Notificaci√≥n cr√≠tica)
            if (timeLeft <= 5 && timeLeft > 0) {
                timeElement.classList.add('text-success');
                if (timeLeft === 5) {
                    addUpdate('El repartidor est√° a 5 minutos de tu ubicaci√≥n. ¬°Prep√°rate!', 'warning');
                }
            }
            
            // Actualizar distancia (Simulaci√≥n de API/GPS)
            const distance = (timeLeft * 0.175).toFixed(1); // 0.175 km/min
            document.getElementById('distance-info').innerHTML = 
                `El repartidor se encuentra a <strong>${distance} km</strong> de tu ubicaci√≥n`;
        } else {
            clearInterval(timer);
            const timeElement = document.getElementById('estimated-time-display');
            timeElement.innerHTML = `<span class="text-success">¬°Lleg√≥!</span>`;
            addUpdate('¬°Pedido entregado exitosamente!', 'success');
        }
    }
    
    function addUpdate(message, type = 'info') {
        const updatesDiv = document.getElementById('real-time-updates');
        const iconClass = type === 'warning' ? 'bi bi-bell-fill' : 'bi bi-arrow-down-left';
        const colorClass = type === 'warning' ? 'alert-warning' : 'alert-info';
        
        const newUpdate = document.createElement('div');
        newUpdate.className = `alert ${colorClass} py-2 small mb-2`;
        newUpdate.innerHTML = `<i class="${iconClass} me-2"></i> <strong>Sistema:</strong> ${message}`;
        
        updatesDiv.prepend(newUpdate);
    }
    
    // Simulaci√≥n de la funci√≥n para activar/desactivar canales (API Call: PUT /api/user/notifications)
    function toggleChannel(channel) {
        const card = document.querySelector(`.channel-card[onclick="toggleChannel('${channel}')"]`);
        const isActive = card.classList.contains('active');
        
        if (isActive) {
            card.classList.remove('active');
            alert(`Notificaciones por ${channel} desactivadas (API PUT)`);
        } else {
            card.classList.add('active');
            alert(`Notificaciones por ${channel} activadas (API PUT)`);
        }
    }
    
    // Iniciar temporizador (Cada 5 segundos en demo para mostrar los cambios r√°pido)
    const timer = setInterval(updateDeliveryTime, 5000); 
    
    // Inicializar
    document.addEventListener('DOMContentLoaded', function() {
        updateDeliveryTime(); // Llamada inicial para establecer el ETA
    });
</script>
</body>
</html>
